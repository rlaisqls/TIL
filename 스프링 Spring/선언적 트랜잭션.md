# 🍃  선언적 트랜잭션

트랜잭션의 맥락에서 Spring Framework의 선언적 트랜잭션 인프라의 내부 작동 원리를 알아보자.

스프링의 선언적 트랜잭션 관리는 스프링 AOP(aspect-oriented programming)로 만들어졌다. 하지만 AOP를 통해 관점이 완전히 분리되어있기 때문에 트랜잭션을 이해하기 위해 AOP를 공부할 필요는 없다.

Spring Framework의 선언적 트랜잭션 관리는 개별 메소드 수준까지 트랜잭션 동작(또는 그것의 부족)을 지정할 수 있다는 점에서 EJB CMT와 유사하다. 하지만 둘은 분명한 차이점을 가진다.

- JTA와 묶여있는 EJB CMT와 다르게, 스프링의 선언적 트랜잭션 관리는 모든 환경에서 작동한다. 구성파일만 조정하면 JDBC, JPA, Hibernate 어디서 작동하든 상관없다.

- Spring Framework에서는 선언적 롤백 규칙을 제공한다. 즉, 롤백 규칙에 대한 명령적 및 선언적 지원이 모두 제공된다.

- AOP를 통해 '트랜잭션 롤백' 구현을 custom할 수 있다.

롤백 규칙의 개념은 중요하다. 이를 통해 자동 롤백을 유발해야 하는 예외(및 throwable)를 지정할 수 있다. 이 옵션의 중요한 이점은 비즈니스 개체가 트랜잭션 인프라에 의존하지 않는다는 것이다. 즉, 비즈니스 개체가 Spring 트랜잭션 API 또는 다른 Spring API를 가져오지 않아도 트랜잭션을 적용할 수 있다.

## Spring의 선언적 트랜잭션 구현

Spring 에서 선언적 트랜잭션을 사용하려면 `@Transactional`를 붙일 수 있다. 그 어노테이션을 붙이면, 내부의 transaction infrastructure가 트랜잭션을 처리해준다.

트랜잭션을 AOP로 처리해주는 것은 `TransactionInterceptor`이다. `TransactionInterceptor`는 명령형 및 반응형 프로그래밍 모델에 대한 트랜잭션 관리를 제공한다.

다음 이미지는 트랜잭션 프록시가 진행되는 과정을 나타낸 그림이다.

![image](https://user-images.githubusercontent.com/81006587/200781511-e743f68f-0e75-4761-bfdd-95945a5cd68f.png)
