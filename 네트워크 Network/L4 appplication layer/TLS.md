# π“΅ TLS

HTTPλ” Hypertext Transfer Protocolμ μ•½μ–΄μ΄λ‹¤. Hypertext μ¦‰, HTMLμ„ μ „μ†΅ν•λ” ν†µμ‹  ν”„λ΅ν† μ½μ„ μλ―Έν•λ” κ²ƒμ΄λ‹¤.

κ·Έλ¦¬κ³ , HTTPSμ μ•½μλ” Hypertext Transfer Protocol Secureμ΄λ‹¤. κ°„λ‹¨ν•κ² λ§ν•μλ©΄ HTMLν†µμ‹  κ·μ•½μ΄κΈ΄ν•λ° κ·Έκ² μ•μ „ν•κ² μ΄λ£¨μ–΄μ§„λ‹¤λ” κ²ƒμ΄λ‹¤. HTTPSμ—λ” TLSλΌλ” ν”„λ΅ν† μ½μ΄ ν•¨κ» μ‚¬μ©λμ–΄, μ‚¬μ©μμ μΈμ¦ κ³Όμ •μ„ μ¶”κ°€λ΅ κ±°μΉκ² λλ‹¤.

![image](https://user-images.githubusercontent.com/81006587/216963905-420674e8-3330-4adb-b93e-4f0425edd095.png)

## TLS

TLSλ” Transport Layer Securityμ μ•½μλ΅, μ»΄ν“¨ν„° λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ ν†µμ‹  λ³΄μ•μ„ μ κ³µν•λ„λ΅ μ„¤κ³„λ μ•”νΈν™” ν”„λ΅ν† μ½μ΄λ‹¤. ν†µμ‹ μ„ ν•λ” κ³Όμ •μ—μ„ λ„μ²­, κ°„μ„­, μ„μ΅°λ¥Ό λ§‰μ„ μ μλ„λ΅ μ•”νΈ μ½”λ“λ¥Ό κµν™ν•κ³  μΈμ¦ν•λ” μ μ°¨λ¥Ό κ±°μΉλ„λ΅ ν•λ‹¤.TLS μ„μ—μ„ HTTPκ°€ λ™μ‘ν•λ©΄ HTTPSκ°€ λκ³ , FTPκ°€ λ™μ‘ν•λ©΄ SFTPκ°€ λλ‹¤. (μ¦‰, κΌ­ HTTPSλ§μ„ μ„ν• κ²ƒμ€ μ•„λ‹λ‹¤.)

[TLS](https://en.wikipedia.org/wiki/Comparison_of_TLS_implementations)μ—λ„ μ—¬λ¬ κµ¬ν„μ΄ μλ‹¤.

HTTPSλ¥Ό μ–κΈ°ν• λ–„ SSLλΌλ” μ©μ–΄λ¥Ό μ‚¬μ©ν•κΈ°λ„ ν•λ‹¤. μ›λ μ²μ HTTPSκ°€ λ§λ“¤μ–΄μ΅μ„λ•λ” Netscape Communicationsκ°€ κ°λ°ν• SSL(Secure Sockets Layer)κ°€ μ‚¬μ©λμ—μ—λ”λ°, IETF(Internet Engineering Task Force)μ—μ„ ν‘μ¤€μΌλ΅ TLSλ¥Ό λ‹¤μ‹ μ •μν•λ©΄μ„ μ΄μ λ” μ‚¬μ©λμ§€ μ•κ² λ κµ¬λ²„μ „μ΄λ‹¤. ν•μ§€λ§ TLSκ°€ SSLμ„ κ³„μΉλ°›μ•„μ„ λ§λ“¤μ–΄μ§„ κ²ƒμ΄λ‹ κ°λ…μ€ κ±°μ λΉ„μ·ν•λ‹¤κ³  λ³Ό μ μλ‹¤.

## μ¥λ‹¨μ 

κ³µκ°ν‚¤ μ•”νΈν™” λ°©μ‹κ³Ό λ€μΉ­ν‚¤ μ•”νΈν™” λ°©μ‹μ„ κ°™μ΄ μ‚¬μ©ν•μ—¬ λ•λ¶„μ— λ³΄μ•μƒ μ•μ „ν•λ‹¤λ” μ¥μ μ΄ μμ§€λ§, μΈμ¦μ„ μ μ§€ λΉ„μ©μ΄ λ“¤κ³  μ•”νΈν™”, λ³µνΈν™” κ³Όμ • λ•λ¬Έμ— HTTPμ— λΉ„ν•΄μ„ λλ¦¬λ‹¤λ” λ‹¨μ μ΄ μλ‹¤.

## λ³΄μ•μ  νΉμ„±

ν¨ν‚·μ΄ μ•”νΈν™”λμ–΄ μ†΅μμ‹  λλ―€λ΅ μ •λ³΄νƒμ·¨ λ¶€λ¶„μ—μ„λ” κ°•ν•λ‹¤. κΈ°λ°€μ„±μ΄ μ°μ„ μ΄λ―€λ΅ **μ¤λ‹ν•‘ κ³µκ²©(sniffing attack)**μ—μ„ λ›°μ–΄λ‚ λ³΄μ•μ„±μ„ λ³΄μΈλ‹¤. λ‹¤λ§ μ•”νΈν™”λ ν¨ν‚·μ΄ ν΄λΌμ΄μ–ΈνΈ PC λλ” μ„λ²„λ΅ μ „μ†΅λκΈ° λ•λ¬Έμ— μ†΅μμ‹ μκ°„ λ°μ΄ν„° κµν™μ΄ μΌμ–΄λ‚λ” μΌμ— λ€ν•΄μ„λ” λ¬΄λ ¥ν•΄μ§„λ‹¤. **κ°μΈμ •λ³΄μ μ¶, κΈ°λ°€μ •λ³΄μ μ¶, DDoS, APT, μ•…μ„±μ½”λ“ κ³µκ²©**μ΄ λ°μƒν•  κ²½μ° λ¬΄λ ¥ν™”λλ‹¤.

## μΈμ¦μ„

TLS ν†µμ‹ μ„ ν•λ ¤λ©΄ μΈμ¦μ„κ°€ ν•„μ”ν•λ°, μ΄ μΈμ¦μ„λ” κ³µμΈλ CAλ΅λ¶€ν„° λ°κΈ‰ λ°›μ•„μ•Όν•λ‹¤. κ·Έ μΈμ¦μ„λ” κ³µκ°ν‚¤μ™€ λΉ„λ°€ν‚¤, μ„λ…κ³Ό Finger Print λ“±λ“±μ μΈμ¦ μ •λ³΄λ¥Ό κ°€μ§€κ³  μλ‹¤.

μμ„Έν• μ μ°¨λ” [λ¬Έμ„](TLSβ€…μΈμ¦μ„β€…λ°κΈ‰β€…μ μ°¨λ¥Όβ€…μ΄ν•΄ν•΄λ³΄μ.md)μ—μ„ λ³Ό μ μλ‹¤.

# λ³΄μ• μΈμ¦ κ³Όμ •

μ„λ²„κ°€ CAμ—κ² μΈμ¦μ„λ¥Ό λ°κΈ‰λ°›μ•λ‹¤κ³  κ°€μ •ν–μ„λ–„, κ·Έ μ„λ²„μ—κ² ν΄λΌμ΄μ–ΈνΈκ°€ μ”μ²­μ„ λ³΄λ‚΄λ©΄ μ–΄λ–¤ ν†µμ‹  κ³Όμ •μ„ κ±°μΉλ”μ§€ μ‚΄ν΄λ³΄μ.

<img src="https://user-images.githubusercontent.com/81006587/216968207-6977af3d-53d0-4bd3-a4a1-0c6092a23c7c.png" height=500px>

### 1. Client : Client Hello

Clientκ°€ μ„λ²„μ— μ ‘μ†ν• λ• Serverμ—κ² λ‡κ°€μ§€ λ°μ΄ν„°λ¥Ό λ¨Όμ € μ•λ ¤μ¤€λ‹¤.

- random : ν΄λΌμ΄μ–ΈνΈλ” 32λ°”μ΄νΈ λ‚μκ°’μ„ μ „λ‹¬ν•΄μ„ μ „λ‹¬ν•λ‹¤. μ΄ λλ¤κ°’μ€ λ‚μ¤‘μ— λΉ„λ°€ λ°μ΄ν„°(master secret)λ¥Ό μ„ν•΄ μ‚¬μ©λλ‹¤.

- Session ID : λ§¤λ² μ—°κ²°ν•  λ•λ§λ‹¤ Handshake κ³Όμ •μ„ μ§„ν–‰ν•λ” κ²ƒμ€ λΉ„ν¨μ¨μ μ΄λ‹ μµμ΄ ν•λ² μ „μ²΄ Handshake κ³Όμ •μ„ μ§„ν–‰ν•κ³  Session IDλ¥Ό κ°€μ§„λ‹¤. ν›„μ—λ” μ΄ Session IDλ¥Ό μ‚¬μ©ν•΄μ„ μ„ κ³Όμ •μ„ λ°λ³µν•΄μ„ μ§„ν–‰ν•μ§€ μ•λ”λ‹¤. (μ•μΌλ΅μ ν†µμ‹ μ—λ„ κ³„μ†ν•΄μ„ Session IDκ°’μ΄ ν¬ν•¨λ  κ²ƒμ΄λ‹¤.)

<img src="https://user-images.githubusercontent.com/81006587/216971608-d402ef28-ab86-43f2-b7d1-a05eefcbc0ee.png" height=275px>

- cipher suite : ν΄λΌμ΄μ–ΈνΈκ°€ μ§€μ›κ°€λ¥ν• ν‚¤ κµν™ μ•κ³ λ¦¬μ¦, λ€μΉ­ν‚¤ μ•”νΈ μ•κ³ λ¦¬μ¦, ν•΄μ‹ μ•κ³ λ¦¬μ¦ λ©λ΅μ„ μ•λ ¤μ¤€λ‹¤. μ΄λ ‡κ² μ „μ²΄ λ©λ΅μ„ μ£Όλ©΄ μ„λ²„λ” μµμ μ μ•κ³ λ¦¬μ¦μ„ μ„ νƒν•λ‹¤.

`TLS_RSA_WITH_AES_128_GCM_SHA256` <- μ΄λ°μ‹μΌλ΅ λ°μ΄ν„°λ¥Ό μ „λ‹¬ν•λ”λ°, ν‚¤ κµν™ μ•κ³ λ¦¬μ¦μ€ RSA, λ€μΉ­ν‚¤ μ•κ³ λ¦¬μ¦μ€ AES_128 GCMλ°©μ‹μ„ μ‚¬μ©ν•κ³  Hash μ•κ³ λ¦¬μ¦μΌλ΅λ” SHA256μ„ μ‚¬μ©ν•λ‹¤λ” μλ―Έμ΄λ‹¤.

μ•”νΈν™” μ•κ³ λ¦¬μ¦μΌλ΅ μ“°μ΄λ” κ²ƒλ“¤μ€ μ•„λμ™€ κ°™μ€ κ²ƒλ“¤μ΄ μλ‹¤.

- ν‚¤κµν™: RSA, Diffie-Hellman, ECDH, SRP, PSK
- λ€μΉ­ν‚¤ μ•”νΈ: RC4, νΈλ¦¬ν” DES, AES, IDEA, DES, ARIA, ChaCha20, Camellia (SSLμ—μ„λ” RC2)
- ν•΄μ‹ ν•¨μ: TLSμ—μ„λ” HMAC-MD5 λλ” HMAC-SHA. (SSLμ—μ„λ” MD5μ™€ SHA)

### 2. Server : Server Hello

TLS Version, μ•”νΈν™” λ°©μ‹(Clientκ°€ λ³΄λ‚Έ μ•”νΈν™” λ°©μ‹ μ¤‘μ— μ„λ²„κ°€ μ‚¬μ© κ°€λ¥ν• μ•”νΈν™” λ°©μ‹μ„ μ„ νƒ), Server Random Data(μ„λ²„μ—μ„ μƒμ„±ν• λ‚μ, λ€μΉ­ν‚¤λ¥Ό λ§λ“¤ λ• μ‚¬μ©), SessionID(μ ν¨ν• Session ID)λ¥Ό μ „λ‹¬ν•λ‹¤.

### 3. Server : Server Certificate

μ„λ²„μ μΈμ¦μ„λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚΄λ” λ‹¨κ³„λ΅, ν•„μ”μ— λ”°λΌ CAμ Certificateλ„ ν•¨κ» μ „μ†΅ν•λ‹¤.

> ν΄λΌμ΄μ–ΈνΈλ” μ΄ ν¨ν‚·μ„ ν†µν•΄ μ„λ²„μ μΈμ¦μ„κ°€ λ¬΄κ²°ν•μ§€ κ²€μ¦ν•λ‹¤.

### 4. Server : Server ket exchange (μ„ νƒ)

ν‚¤κµν™μ— μ¶”κ°€ μ •λ³΄κ°€ ν•„μ”ν•λ©΄ μ΄λ•, μ „μ†΅ν•λ‹¤. μλ¥Ό λ“¤λ©΄, μ•κ³ λ¦¬μ¦μ„ Diffie-HellmanμΌλ΅ μ‚¬μ©ν•΄μ„ μ†μ, μ›μ‹κ·Ό λ“± κ°’μ΄ ν•„μ”ν• κ²½μ° λ“±μ΄ μλ‹¤.

### 5. Server : Certificate request (μ„ νƒ)

μ„λ²„ μ—­μ‹ ν΄λΌμ΄μ–ΈνΈλ¥Ό μΈμ¦ν• λ• μΈμ¦μ„λ¥Ό μ”μ²­ν•  μ μμ§€λ§, λ°›μ§€ μ•μ„ μλ„ μλ‹¤.

### 6. Server : Server Hello Done

μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Ό λ©”μ‹μ§€λ¥Ό λ¨λ‘ λ³΄λƒλ‹¤.

### 7. Client : Certificate (μ„ νƒ)

μ„λ²„κ°€ μΈμ¦μ„λ¥Ό μ”μ²­ν–μΌλ©΄ μ „μ†΅ν•κ³ , μ•„λ‹λ©΄ μƒλµν•λ‹¤.

### 8. Client : Client Key Exchange

μ°μ„  μ„λ²„μ—μ„ λ³΄λ‚Έ μΈμ¦μ„κ°€ λ¬΄κ²°ν•μ§€ ν™•μΈν•΄λ³Έλ‹¤. OSλ‚ λΈλΌμ°μ €λ” κΈ°λ³Έμ μΌλ΅ CA λ¦¬μ¤νΈλ¥Ό κ°€μ§€κ³  μλ‹¤. (Macμ—λ” keyChain, λΈλΌμ°μ €λ” μ†μ¤μ½”λ“) κ·Έλ ‡κΈ° λ–„λ¬Έμ— μ„λ²„μ κ³µκ°ν‚¤μ™€ CA κ³µκ°ν‚¤λ¥Ό λΉ„κµν•λ©΄ μ„λ²„κ°€ λ³΄λ‚Έ μΈμ¦μ„κ°€ μ •μƒμ μΈμ§€ κ²€μ¦ν•  μ μλ‹¤.

CAλ” μ„λ²„μ—κ² μΈμ¦μ„λ¥Ό λ°κΈ‰ν•΄μ¤„λ• μ μ¶λ°›μ€ μ„λ²„μ κ³µκ°ν‚¤μ— CAμ κ³µκ°ν‚¤ μ •λ³΄λ¥Ό μ•”νΈν™”ν•μ—¬ λ„£μ–΄λ†“λ”λ‹¤. κ·Έλ¬λ©΄ ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ μΈμ¦μ„λ¥Ό λ°›μ€ λ‹¤μ, μ•κ³ μλ” CAμ κ³µκ°ν‚¤λ¥Ό ν•΄μ‹ν•΄μ„ ν•΄λ‹Ή κ°’κ³Ό μΌμΉν•λ”μ§€ λΉ„κµν•λ©΄ ν•΄λ‹Ή μΈμ¦μ„κ°€ μ ν¨ν•μ§€λ¥Ό ν™•μΈν•  μ μλ‹¤. 

μΈμ¦μ„λ¥Ό ν™•μΈν• λ‹¤μμ—λ” ν΄λΌμ΄μ–ΈνΈκ°€ μƒμ„±ν• λλ¤κ°’κ³Ό μ„λ²„μ—μ„ λ³΄λ‚΄μ¤€ λλ¤κ°’μ„ ν•©μ³ pre-master secretλ¥Ό λ§λ“ λ‹¤. μ΄ κ°’μ„ μ‚¬μ©ν•΄μ„ μ„Έμ…μ— μ‚¬μ©λ  ν‚¤λ¥Ό μƒμ„±ν•κ² λλ”λ°, κ·Έ ν‚¤κ°€ λ°”λ΅ λ€μΉ­ν‚¤μ΄λ‹¤.

μ¤‘μ”ν• μ •λ³΄μ΄κΈ° λ•λ¬Έμ— μ•„κΉ λ°›μ•λ μΈμ¦μ„ μ•μ— μλ” μ„λ²„μ κ³µκ°ν‚¤λ΅ μ•”νΈν™”ν•΄μ„ μ „μ†΅ν•λ‹¤.

### 9. Certificate verify (μ„ νƒ)

ν΄λΌμ΄μ–ΈνΈμ— λ€ν• Certificate requestλ¥Ό λ°›μ•λ‹¤λ©΄ λ³΄λ‚Έ μΈμ¦μ„μ— λ€ν• κ°μΈν‚¤λ¥Ό κ°€μ§€κ³  μλ‹¤λ” κ²ƒμ„ μ¦λ…ν•λ‹¤. (handshakeκ³Όμ •μ—μ„ μ£Όκ³  λ°›μ€ λ©”μ‹μ§€ + master secretμ„ μ΅°ν•©ν• hashκ°’μ— κ°μΈν‚¤λ΅ λ””μ§€ν„Έ μ„λ…ν•μ—¬ μ „μ†΅ν•λ‹¤.)

### 10. Server & Client : Change Cipher Spec

μ΄μ λ¶€ν„° μ „μ†΅λλ” λ¨λ“  ν¨ν‚·μ€ ν‘μƒλ μ•κ³ λ¦¬μ¦κ³Ό ν‚¤λ¥Ό μ΄μ©ν•μ—¬ μ•”νΈν™” ν•κ² λ‹¤ μ•λ¦¬κ³  λλ‚Έλ‹¤. μ΄μ  μ΄ λ’¤λ΅ ν†µμ‹ λλ” λ¨λ“  λ°μ΄ν„°λ” λ€μΉ­ν‚¤λ΅ μ•”νΈν™”ν•΄μ„, μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈλΌλ¦¬λ§ ν•΄λ…ν•  μ μλ„λ΅ λ§λ“ λ‹¤.

# κ²°λ΅ 

TLSλ” μ΄λ¬ν• κ³Όμ •μ„ κ±°μ³μ„ ν†µμ‹  λ³΄μ•μ„ μ μ§€ν•λ‹¤. μ•”νΈ μ½”λ“λ¥Ό κµν™ν•κ³  μΈμ¦ν•λ” μ μ°¨κ°€ μμΌλ‹ ν†µμ‹  κ³Όμ •μ—μ„μ λ„μ²­, κ°„μ„­, μ„μ΅°λ¥Ό λ§‰μ„ μ μλ‹¤. (μ¤‘κ°„μ— ν¨ν‚·μ„ νƒμ·¨ν•κ±°λ‚ ν•΄λ„, λ€μΉ­ν‚¤κ°€ μ—†μΌλ©΄ ν•΄λ…μ΄ λ¶κ°€λ¥ν•κΈ° λ–„λ¬Έ)

λ­”κ°€ λ³µμ΅ν•΄λ³΄μ€λ”λ°, μμ„Έν λ“¤μ—¬λ‹¤λ³΄λ©΄ λ§‰ μ–΄λ µμ§„ μ•μ€ κ²ƒ κ°™λ‹¤. ν„μ¬ httpsλ” κ±°μ λ¨λ“  μΈν„°λ„·μ—μ„ μ‚¬μ©λκ³  μλ” ν”„λ΅ν† μ½μ΄κΈ° λ•λ¬Έμ— μ΄λ ‡κ² κ³µλ¶€ν•΄λ†“μΌλ©΄ λ‚μ¤‘μ— μ‘μ©ν•  μΌμ΄ κΌ­ μƒκΈ°μ§€ μ•μ„κΉ? μ‹¶μ€ λ§μμ΄λ‹¤.