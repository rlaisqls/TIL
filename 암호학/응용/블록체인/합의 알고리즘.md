
합의 알고리즘은 분산 네트워크에서 블록체인의 상태에 대해 모든 노드가 동의하도록 하는 메커니즘이다. Bitcoin에서 사용하는 Proof of Work 외에도 다양한 합의 메커니즘이 개발되어 사용되고 있다.

## Proof of Stake (지분 증명)

Proof of Work에 대한 대안으로, 채굴의 필요성을 제거하여 작업 증명을 개선하는 것을 목표로 하는 합의 알고리즘이다.

- 암호화폐 보유자들은 의결권을 얻기 위해 잔고를 걸고(스테이킹) 거래를 검증하기 위해 네트워크에 의해 선택될 기회를 갖는다.
- 스테이킹을 통해 노드 또는 validator로서의 역할을 수행할 수 있다.
- 고가의 하드웨어 요구사항이나 어려운 계산 과정은 없지만 암호화폐 보유자들이 자금을 투입하는 데에서 경제성이 요구된다.
  - 장점: 채굴이 없어 전력 공급에 낭비되는 에너지가 적다.
  - 단점: 중앙 집중도 및 빈부격차가 커진다는 문제가 있다.
- Nothing at Stake 문제: 마이너가 여러 블록을 자유롭게 생성해 포크 및 서비스 거부 공격 가능성을 유발한다. 이 문제를 해결하기 위해 네트워크의 규칙을 위반한 벨리데이터의 지분을 삭감시키는 slashing 알고리즘을 사용한다.

- 검증자 선택 방식
  - 지분 크기(스테이킹한 액수)
  - 보유 기간(가장 오랫동안 암호화폐를 보유하고 있는 주소)
  - 재산(특정 시간 이상 가장 많은 암호화폐를 유지한 주소)
  - 일부 암호화폐는 지분 규모와 해시를 조합해 무작위로 선택하기도 하고, 코인 보유 일수에 따라 선택하기도 한다. (RANDAO와 VDF를 함께 사용)

- 사용 예시: Ethereum 2.0, Dash, Neo, Tezos 등

## Delegated Proof of Stake (위임 지분 증명)

Proof of Stake의 변형으로, 토큰 보유자들이 투표를 통해 소수의 대표자(Delegate)를 선출하여 블록 검증을 위임하는 합의 알고리즘이다.

- 네트워크 사용자들이 투표를 통해 블록을 검증할 대표자(Delegate)를 선출한다.
- 각 사용자는 보유한 코인을 스테이킹하여 최대 30명의 후보에게 투표할 수 있다.
- 선출된 대표자들은 트랜잭션을 검증하고 새로운 블록을 생성한다.
- 검증된 블록에서 발생한 트랜잭션 수수료는 대표자가 받으며, 이는 해당 대표자에게 투표한 사용자들과 공유된다.

- EOS 구현
  - Daniel Larimer가 2014년에 개발했으며, 2015년 BitShares에서 처음 구현되었다.
  - EOS는 21명의 대표자(Block Producer)를 선출한다.
  - 선거는 2분 6초마다 진행된다.
  - 상위 21명의 블록 프로듀서 후보가 선출되어 블록 검증을 수행한다.

- 장단점
  - 장점: 높은 확장성으로 대용량 트랜잭션을 빠르게 처리할 수 있다. PoW나 전통적인 PoS에 비해 낮은 에너지 소비와 하드웨어 요구사항을 가진다.
  - 단점: 소수의 대표자만이 블록을 검증하므로 네트워크가 소수에게 집중될 우려가 있다. 투표 매수(Vote Buying)에 취약할 수 있다.

- 사용 예시: EOS, Tron, Lisk, BitShares

## Proof of History (역사 증명)

Solana에서 사용하는 합의 메커니즘으로, 블록체인을 위한 암호화 타임스탬프 역할을 하는 방식이다.

- 검증 가능한 지연 함수(Verifiable Delay Function, VDF)라는 암호화 함수를 사용하여 각 블록에 타임스탬프를 생성한다.
- 특정 이벤트가 특정 시점에 발생했음을 증명하는 역사적 기록을 생성한다.
- 모든 노드가 각 트랜잭션의 순서에 동의할 필요가 없어, 트랜잭션 처리 속도가 크게 향상된다.
- PoW와 같은 복잡한 계산이 필요 없어 에너지 효율적이다.
- 변조 방지 타임스탬프 시퀀스를 생성하여 Solana가 초당 65,000개 이상의 트랜잭션을 처리할 수 있게 한다.
  - 이는 현재 가장 빠른 블록체인 중 하나이다.

- 하이브리드 구현
  - Solana는 PoH와 PoS를 결합한 하이브리드 합의 모델을 구현한다.
  - Tower BFT는 PBFT의 변형으로, PoH가 합의 전에 글로벌 클럭 역할을 수행한다.
  - 이를 통해 확장성과 트랜잭션 속도 문제를 해결한다.

- 사용 예시: Solana

## Proof of Storage / Proof of Space (저장 공간 증명)

저장 공간을 활용하는 합의 메커니즘으로, Proof of Capacity, Proof of Space-Time 등 다양한 이름으로 불린다.

- 하드 드라이브와 같은 대용량 저장 공간을 사용하여 합의를 달성한다.
- 보유한 저장 공간이 클수록 더 많은 무작위 숫자를 소유하게 되고, 블록 생성에 성공할 확률이 높아진다.

- Chia Network
  - Proof of Space and Time (PoST)이라는 나카모토 합의를 사용한다.
  - Plotting(플로팅), Proving/Farming(증명/파밍), Verifying(검증) 과정을 거친다.
  - Plot은 Chia의 PoST 합의에서만 유용하며, 실제 데이터를 포함하지 않는다.
  - 2021년 2월 백서를 공개하고 메인넷과 Chia 코인(XCH)을 출시했다.

- Filecoin
  - Proof of Space-Time 합의를 사용하여 스토리지 제공자가 계속해서 저장 공간을 제공하고 있음을 증명한다.
  - 클라이언트와 스토리지 제공자 간에 180~540일 기간의 저장 계약을 체결한다.
  - 실제 데이터를 저장하는 분산 파일 저장 서비스로 기능한다.
  - 마이너들이 하드 드라이브 공간을 제공하고, 사용자들이 그 서비스에 대한 대가를 지불한다.

- 사용 예시: Chia, Filecoin, Storj, Sia, Permacoin, Torcoin
  - Chia: 유용한 데이터를 저장하지 않으며, 담보금이 필요하지 않다.
  - Filecoin, Storj, Sia: 실제 사용자 데이터를 저장하는 서비스를 제공한다.

---
참고

- [Proof of Stake - Ethereum.org](https://ethereum.org/en/developers/docs/consensus-mechanisms/pos/)
- [Delegated Proof of Stake - Ledger Academy](https://www.ledger.com/academy/what-is-delegated-proof-of-stake-dpos)
- [EOS Consensus Protocol](https://developers.eos.io/welcome/v2.0/protocol-guides/consensus_protocol/)
- [Proof of History: A Clock for Blockchain - Solana](https://medium.com/solana-labs/proof-of-history-a-clock-for-blockchain-cf47a61a9274)
- [Solana Whitepaper](https://solana.com/solana-whitepaper.pdf)
- [Proof of Space - Chia Documentation](https://docs.chia.net/chia-blockchain/consensus/proof-of-space-1.0/)
- [Filecoin Proof of Space-Time](https://filecoin.io/proof-of-spacetime.pdf)
