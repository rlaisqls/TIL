# ApplicationContext과 BeanDefinition

## 스프링 컨테이너(Spring Container)
스프링에서 DI를 이용하여 애플리케이션을 구성하는 여러 빈(Bean)들의 생명주기(Lifecycle)와 애플리케이션의 서비스 실행 등을 관리하며 생성된 인스턴스들에게 기능을 제공하는 것을 부르는 말이다.
프로그래머의 개입 없이도 컨테이너에 설정된 내용에 따라 빈을 알아서 참조하고 관리한다.
대표적으론 BeanFactory와 ApplicationContext 가 있다.

## BeanFactory
스프링 컨테이너의 최상위 인터페이스로서, 스프링 빈을 관리하고 조회하는 역할을 담당힌디.
getBean() 을 제공한다.
지금까지 우리가 사용했던 대부분의 기능은 BeanFactory가 제공하는 기능이다.

## ApplicationContext
BeanFactory 기능을 모두 상속받아서 제공한다. 빈을 관리하고 조회하는 기능 말고도 환경변수를 처리하는 기능, 메시지를 국제화해주는 기능, 리소스를 편리하게 조회할 수 있게 하는 기능 등등의 부가기능도 함께 구현되어있다.


## BeanDefinition
BeanDefinition은 빈 설정 메타정보인데, 스프링은 이 인터페이스를 통해 다양한 설정 형식을 지원한다. @Bean, <bean> 당 각각 하나씩 메타 정보가 생성되고
스프링 컨테이너는 이 메타정보를 기반으로 스프링 빈을 생성한다. BeanDefinition는 reader로 코드를 직접 스캔해서 메타 정보를 만들어준다.

- AnnotationConfigApplicationContext 는 AnnotatedBeanDefinitionReader 를 사용해서 AppConfig.class 를 읽고 BeanDefinition 을 생성한다.
- GenericXmlApplicationContext 는 XmlBeanDefinitionReader 를 사용해서 appConfig.xml 설정 정보를 읽고 BeanDefinition 을 생성한다.

### BeanDefinition 정보
 - Scope: 싱글톤(기본값)
 - lazyInit: 스프링 컨테이너를 생성할 때 빈을 생성하는 것이 아니라, 실제 빈을 사용할 때 까지 최대한
생성을 지연처리 하는지 여부
 - InitMethodName: 빈을 생성하고, 의존관계를 적용한 뒤에 호출되는 초기화 메서드 명
 - DestroyMethodName: 빈의 생명주기가 끝나서 제거하기 직전에 호출되는 메서드 명
 #### 팩토리 메서드 등록이 아닐때만 사용
 - BeanClassName: 생성할 빈의 클래스 명
 - Constructor arguments, Properties: 의존관계 주입에서 사용한다.
 #### 팩토리 메서드 등록에서만 사용
 - factoryBeanName: 팩토리 역할을 수행하는 빈의 이름
 - factoryMethodName: 빈을 생성할 팩토리 메서드 지정

# 웹 애플리케이션과 싱글톤
스프링은 기업용 온라인 서비스 기술을 지원하기 위해 탄생했다. 웹 애플리케이션은 보통 여러 고객이 요청을 동시에 보내는데, 이럴 때 마다 새로운 객체를 생성해서 반환하는 것은 메모리 낭비가 너무 심하다. 그래서 고안된 것이 생성된 하나의 객체를 공유해서 사용하도록 설계한 '싱글톤 패턴'이다.
싱글톤 패턴은 이미 만들어진 객체를 재사용하기 때문에 아주 효율적이다!
하지만 싱글톤 패턴도 문제점을 가지고 있다.

### 싱글톤 패턴의 문제점
 - 싱글톤 패턴을 구현하는 코드 자체가 많이 들어간다.
 - 의존관계상 클라이언트가 구체 클래스에 의존한다. DIP를 위반한다.
 - 클라이언트가 구체 클래스에 의존해서 OCP 원칙을 위반할 가능성이 높다.
 - 테스트하기 어렵다.
 - 내부 속성을 변경하거나 초기화 하기 어렵다.
 - private 생성자로 자식 클래스를 만들기 어렵다.
 - 결론적으로 유연성이 떨어진다.
 - 안티패턴으로 불리기도 한다

그래서 스프링은 이 싱글톤 패턴을 더 잘 사용할 수 있도록 싱글톤 컨테이너를 관리해주는 기능을 지원하고 있다.

## 싱글톤 컨테이너
스프링 컨테이너는 싱글턴 패턴을 적용하지 않아도, 객체 인스턴스를 싱글톤으로 관리한다. 스프링 컨테이너는 싱글톤 컨테이너 역할을 한다. 이렇게 싱글톤 객체를 생성하고 관리하는 기능을 싱글톤 레지스트리라 한다.
스프링 컨테이너의 이런 기능 덕분에 싱글턴 패턴의 모든 단점을 해결하면서 객체를 싱글톤으로 유지할 수
있다.
스프링을 쓰면 싱글톤 패턴을 위한 지저분한 코드가 들어가지 않아도 되고, DIP, OCP, 테스트, private 생성자로 부터 자유롭게 싱글톤을 사용할 수 있다. 

### 싱글톤 방식의 주의점
객체 인스턴스를 하나만 생성해서 공유하는 싱글톤 방식은 여러 클라이언트가 하나의 같은 객체 인스턴스를 공유하기 때문에 싱글톤 객체는 무상태(stateless)로 설계해야 한다.
특정 클라이언트에 의존적이거나, 값을 변경할 수 있는 필드가 있으면 절대 안된다.
변수가 필요하다면 필드 대신에 자바에서 공유되지 않는, 지역변수, 파라미터, ThreadLocal 등을 사용해야 한다.
