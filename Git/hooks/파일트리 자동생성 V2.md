# ğŸŒ³ íŒŒì¼íŠ¸ë¦¬ ìë™ìƒì„± V2

ì§€ë‚œë²ˆì— ì´ ë ˆí¬ì§€í† ë¦¬ì— íŒŒì¼íŠ¸ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” git hookì„ ë§Œë“¤ì—ˆì—ˆë‹¤.

READMEì— íŒŒì¼ ëª©ë¡ì´ ë”± ë³´ì´ë‹ˆ ì–´ë–¤ ë‚´ìš©ë“¤ì„ ê³µë¶€í–ˆì—ˆëŠ”ì§€ íŒŒì•…í•˜ê¸°ë„ ì‰½ê³ , ê¹”ë”í•´ì ¸ì„œ ì •ë§ ë§Œì¡±ìŠ¤ëŸ¬ì› ë‹¤.

<img src="https://user-images.githubusercontent.com/81006587/216948468-389a7343-d3cc-494a-802e-2fc32cb9a064.png" height=400px>

ê·¸ëŸ°ë° ë¬¸ë“, ì´ ë ˆí¬ì§€í† ë¦¬ì— ì ì€ ê¸€ì˜ ìˆ˜ ê°™ì€ ì •ë³´ë¥¼ í•¨ê¼ ë³´ì—¬ì£¼ë©´ ë” ì¢‹ì§€ ì•Šì„ê¹Œ? í•˜ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.

ê·¸ë˜ì„œ READMEì™€ git hookì— ë‚´ìš©ì„ ë” ì¶”ê°€í•´ë³´ê¸°ë¡œ í–ˆë‹¤! ì¼ë‹¨ ì¶”ê°€í•´ë³¸ ë¶€ë¶„ì€ íŒŒì¼(ê¸€)ì˜ ê°¯ìˆ˜, í´ë” ê°¯ìˆ˜, í‰ê·  ê¸€ ê¸¸ì´ì´ë‹¤. íŒŒì¼ ê°¯ìˆ˜ëŠ” ë‚´ê°€ ì§€ê¸ˆê¹Œì§€ ëª‡ê°€ì§€ì˜ ë‚´ìš©ì„ ê³µë¶€í–ˆëŠ”ì§€ë¥¼ ì•Œ ìˆ˜ ìˆê³ , í‰ê·  ê¸€ ê¸¸ì´ëŠ” ì–¼ë§ˆë‚˜ ì—´ì‹¬íˆ ê¸¸ê²Œ ì ê³ ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆëŠ” ìˆ«ìì´ë‹ˆ ë³´ê³  (ë‚´ê°€) ë™ê¸°ë¶€ì—¬ë¥¼ ë°›ì„ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ì„œ ë§Œë“¤ì–´ë³´ì•˜ë‹¤.

ë³€ê²½ëœ `readme-template.md`ëŠ” ì•„ë˜ì™€ ê°™ë‹¤. backticì€ ì‘ì€ë”°ì˜´í‘œë¡œ ì¹˜í™˜í—€ë‹¤.

```md
# TIL

'''
files            : __FILE_COUNT__
derectories      : __DERECTORY_COUNT__
avg_file_length  : __AVG_FILE_LEGNTH__
'''

__PROJECT_TREE__

```

pre-commit ì½”ë“œëŠ” íŒŒíŠ¸ë³„ë¡œ ì‚´í´ë³´ì.

ì´ë¶€ë¶„ì€ ì´ì „ì—ë„ ìˆì—ˆë“¯ì´, tree ëª…ë ¹ì–´ ì¶œë ¥ ê²°ê³¼ë¥¼ ë§í¬ê°€ ë‹¬ë¦° md í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•´ì£¼ëŠ” ì½”ë“œì´ë‹¤. filepath ë¶€ë¶„ì€ ë³€ìˆ˜ë¡œ ì¹˜í™˜í•´ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤¬ë‹¤.

```bash
#!/bin/bash

export LANG=UTF-8

filepath=/Users/rlaisqls/Documents/github/TIL

function generate_project_tree() {
  tree $filepath -f --dirsfirst --noreport -I '~' --charset ascii $1 |
    gsed -e 's/[|]-\+/â•Šâ”/g' |
    gsed -e 's/[|]/â”ƒ/g' |
    gsed -e 's/[`]/â”—â”/g' |
    gsed -e 's/[-]/â”/g' |
    gsed -e 's:\(â” \)\(\(.*/\)\([^/]\+\)\):\1[\4](\2):g' |
    gsed -e 's/)/)<\/br>/g' |
    gsed -e 's=$filepath/=./=g' |
    gsed -e 's=/Users/rlaisqls/Documents/github/TIL/=./=g' |
    gsed -e 's=/Users/rlaisqls/Documents/github/TIL=./TIL</br>=g' |
    gsed -e 's/â”â”â”/â”/g' |
    gsed -e 's/[ ]/ã€€/g' 
}
```

íŒŒì¼ê³¼ í´ë”ì˜ ìˆ«ìë¥¼ ì„¸ëŠ” ê²ƒì€ findì™€ wc ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í–ˆë‹¤. `find` ëª…ë ¹ì–´ë¡œ ê°ê° f, d íƒ€ì…ì˜ ìš”ì†Œë“¤ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ì¶œë ¥í•˜ë©´ `wc -ã…£`ë¡œ í–‰ì˜ ìˆ˜ë¥¼ ì„¸ì„œ ì¶œë ¥í•˜ëŠ” í˜•ì‹ì´ë‹¤. ê·¸ë¦¬ê³  ê¹”ë”í•œ ì¶œë ¥ì„ ìœ„í•´ gsedë¡œ ê³µë°±ê³¼ ì¤„ë°”ê¿ˆì„ ì—†ì•´ë‹¤.

```bash
function generate_project_file_count() {
  find $filepath -type f \( -name "*.md" \) |
    wc -l |
    gsed -e 's/[ ]//g' |
    gsed -e 's/\n//g' 
}

function generate_project_derectory_count() {
  find $filepath -type d ! -path "*/.git/*" | 
    wc -l | 
    gsed -e 's/[ ]//g' | 
    gsed -e 's/\n//g' 
}
```

ê¸€ì˜ í‰ê·  ê¸¸ì´ë¥¼ ì¸¡ì •í•˜ëŠ” ê²ƒë„ find ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í–ˆê³ , ê·¸ ëª©ë¡ì— í•´ë‹¹í•˜ëŠ” ê¸€ì˜ ë‚´ìš©ì„ `xargs cat`ì´ ë°›ì•„ì„œ ì „ë¶€ ì¶œë ¥í•˜ë©´ `wc` ëª…ë ¹ì–´ê°€ ê¸€ì ìˆ˜ë¥¼ ì„¸ì£¼ëŠ” êµ¬ì¡°ì´ë‹¤. íŒŒì¼ ìˆ˜ê°€ ì ì  ë§ì•„ì§€ë©´ ì´ ê³¼ì •ì—ì„œì˜ ë©”ëª¨ë¦¬ ë¶€í•˜ê°€ ì‹¬í•´ì§€ê² ì§€ë§Œ ì•„ì§ ê±±ì •í•  ìˆ˜ì¤€ì€ ì•„ë‹Œ ê²ƒ ê°™ë‹¤. í˜„ì¬ëŠ” ë‚´ìš©ì´ ì´ 50ë§Œ ê¸€ìì •ë„ ë˜ëŠ”ë°, 1ì–µì´ ë„˜ì–´ê°€ë©´ ê·¸ë–„ë¶€í„° ìµœì í™”ë¥¼ ìƒê°í•´ë´ë„ ë  ê²ƒ ê°™ë‹¤. 

```bash
function file_legnth_total() {
  find $filepath -type f ! -path "*/.git/*" ! -path "*/README.md" | 
    xargs cat | 
    wc -m | 
    gsed 's/ //g' | 
    gsed -e 's/\n//g' 
}

function generate_avg_file_legnth() {
  total=$(file_legnth_total)
  count=$(generate_project_file_count)

  echo $(expr $total / $count)
}
```

readme íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ë¶€ë¶„ì´ë‹¤. ì›ë˜ëŠ” í•¨ìˆ˜ í˜¸ì¶œ ë¶€ë¶„ì´ í•˜ë‚˜ë¼ì„œ ë°‘ë¶€ë¶„ì—ì„œ í˜¸ì¶œí–ˆì—ˆëŠ”ë°, ì¸ìê°€ ì—¬ëŸ¬ê°œê°€ ë˜ì–´ì„œ ê·¸ëƒ¥ ì´ í•¨ìˆ˜ì— ë‹¤ í•©ì³ì¤¬ë‹¤. `cp`ë¡œ í…œí”Œë¦¿ ë‚´ìš©ì„ readmeì— ë³µì‚¬í•´ë†“ê³ , ë³€ìˆ˜ê°€ ë“¤ì–´ê°€ì•¼í•˜ëŠ” ë¶€ë¶„ì„ í•˜ë‚˜ì”© ì±„ì›Œì£¼ëŠ” íë¦„ì´ë‹¤.

ê¸°ì¡´ì—ëŠ” í…œí”Œë¦¿ì— ë³€ìˆ˜ë¥¼ ëŒ€ì…í•œ ë‚´ìš©ì„ ë§Œë“¤ì–´ë†“ê³  `>`ë¥¼ ì‚¬ìš©í•´ì„œ ì‹¤ì œ readme íŒŒì¼ë¡œ ì˜®ê²¨ì£¼ì—ˆë‹¤. ê·¼ë° ì¸ìê°€ ì—¬ëŸ¬ê°œê°€ ë˜ë‹ˆê¹Œ í•˜ë‚˜ë¥¼ ëŒ€ì…í•´ë„£ì€ readme íŒŒì¼ì— ë˜ ë®ì–´ì“°ê¸°ë¥¼ í•´ì•¼í•˜ëŠ”ë°, `$readme > $readme`ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ íŒŒì¼ ë‚´ìš©ì´ ìê¾¸ ë‚ ì•„ê°€ì„œ ëª…ë ¹ì–´ì— `-i` ì˜µì…˜ì„ ë¶™ì—¬ì„œ readme íŒŒì¼ì„ ë°”ë¡œ ìˆ˜ì •í•˜ë„ë¡ ë³€ê²½í–ˆë‹¤.

```bash
function generate_readme() {
  readme="$filepath/README.md"
  readme_template="$filepath/.git/hooks/readme_template.md"

  cp -f "$readme_template" "$readme"

  generate_project_tree . |
    perl -p0e 's/__PROJECT_TREE__/`cat`/se' -i $readme
  
  generate_project_file_count . |
    perl -p0e 's/__FILE_COUNT__/`cat`/se' -i $readme
  
  generate_project_derectory_count . |
    perl -p0e 's/__DERECTORY_COUNT__/`cat`/se' -i $readme
  
  generate_avg_file_legnth . |
    perl -p0e 's/__AVG_FILE_LEGNTH__/`cat`/se' -i $readme
}
```

ì´ ë¶€ë¶„ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì´ê³  ë§¤ë²ˆ ë³€ê²½ëœ readmeíŒŒì¼ì„ ì»¤ë°‹í•˜ê¸°ê°€ ì¢€ ê·€ì°®ì•„ì ¸ì„œ ìë™ìœ¼ë¡œ ì „ ì»¤ë°‹ì— amend í•´ì„œ ì˜¬ë¼ê°€ë„ë¡ í•´ì¤¬ë‹¤.

ê·¼ë° ì´ê²Œ ì»¤ë°‹ì„ í• ë•Œ, í•´ë‹¹ ì»¤ë°‹ì´ ì•„ë‹Œ ë°”ë¡œ ì „ ì»¤ë°‹ì— amend ë˜ì–´ì„œ í•­ìƒ force pushë¥¼ í•´ì•¼í•˜ê³  ì»¤ë°‹ íˆìŠ¤í† ë¦¬ê°€ ë”ëŸ¬ì›Œì§„ë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤. ë­”ê°€ ë°©ë²•ì´ ìˆê² ì§€ë§Œ ë°”ë¡œ ë– ì˜¤ë¥´ëŠ”ê±´ ì—†ì–´ì„œ ì¼ë‹¨ì€ ì´ë ‡ê²Œ í•œë™ì•ˆ ì‚¬ìš©í•˜ê²Œ ë  ê²ƒ ê°™ë‹¤. ì´ê±° ìˆ˜ì •í• ê±°ë©´ ê¹ƒì— ì˜¬ë¦¬ì§€ ì•Šì€ íŒŒì¼ì´ íŠ¸ë¦¬ë¡œ ê°™ì´ ì¶œë ¥ë˜ëŠ” ë¬¸ì œë„ ê°™ì´ í•´ê²°í•˜ê³  ì‹¶ì€ë° ê·¸ê²ƒë„ ë°©ë²•ì„ ëª¨ë¥´ê² ë‹¤. 

```bash
generate_readme .

cd $filepath
git $filepath/README.md
git commit --amend -C HEAD --no-verify
```

ì „ì²´ ì½”ë“œì´ë‹¤.

```bash
#!/bin/bash

export LANG=UTF-8

filepath=/Users/rlaisqls/Documents/github/TIL

function generate_project_tree() {
  tree $filepath -f --dirsfirst --noreport -I '~' --charset ascii $1 |
    gsed -e 's/[|]-\+/â•Šâ”/g' |
    gsed -e 's/[|]/â”ƒ/g' |
    gsed -e 's/[`]/â”—â”/g' |
    gsed -e 's/[-]/â”/g' |
    gsed -e 's:\(â” \)\(\(.*/\)\([^/]\+\)\):\1[\4](\2):g' |
    gsed -e 's/)/)<\/br>/g' |
    gsed -e 's=$filepath/=./=g' |
    gsed -e 's=/Users/rlaisqls/Documents/github/TIL/=./=g' |
    gsed -e 's=/Users/rlaisqls/Documents/github/TIL=./TIL</br>=g' |
    gsed -e 's/â”â”â”/â”/g' |
    gsed -e 's/[ ]/ã€€/g' 
}

function generate_project_file_count() {
  find $filepath -type f \( -name "*.md" \) |
    wc -l |
    gsed -e 's/[ ]//g' |
    gsed -e 's/\n//g' 
}

function generate_project_derectory_count() {
  find $filepath -type d ! -path "*/.git/*" | 
    wc -l | 
    gsed -e 's/[ ]//g' | 
    gsed -e 's/\n//g' 
}

function file_legnth_total() {
  find $filepath -type f ! -path "*/.git/*" ! -path "*/README.md" | 
    xargs cat | 
    wc -m | 
    gsed 's/ //g' | 
    gsed -e 's/\n//g' 
}

function generate_avg_file_legnth() {
  total=$(file_legnth_total)
  count=$(generate_project_file_count)

  echo $(expr $total / $count)
}

function generate_readme() {
  readme="$filepath/README.md"
  readme_template="$filepath/.git/hooks/readme_template.md"

  cp -f "$readme_template" "$readme"

  generate_project_tree . |
    perl -p0e 's/__PROJECT_TREE__/`cat`/se' -i $readme
  
  generate_project_file_count . |
    perl -p0e 's/__FILE_COUNT__/`cat`/se' -i $readme
  
  generate_project_derectory_count . |
    perl -p0e 's/__DERECTORY_COUNT__/`cat`/se' -i $readme
  
  generate_avg_file_legnth . |
    perl -p0e 's/__AVG_FILE_LEGNTH__/`cat`/se' -i $readme
}

cd "$(dirname "$0")" || exit 1
generate_readme .

cd $filepath
git add $filepath/README.md
git commit --amend -C HEAD --no-verify

```

ê°„ë‹¨í•œ ì¶”ê°€ì§€ë§Œ, ì‘ì—…í•˜ëŠ”ë° ê±°ì˜ 3-4ì‹œê°„ì •ë„ ê±¸ë¦° ê²ƒ ê°™ë‹¤...

bashë‚˜ perl ëª…ë ¹ì–´ì— ëŒ€í•œ ì´í•´ë„ê°€ ë‚®ì•„ì„œ ì‚½ì§ˆì„ ì •ë§ ë§ì´ í–ˆë‹¤. ë‹¤ìŒì— git hookìœ¼ë¡œ ë§Œë“¤ê³ ì‹¶ì€ê²Œ ë” ìƒê¸´ë‹¤ë©´ ê·¸ë–„ëŠ” ì¡°ê¸ˆ ë” ì˜í•  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ ê¸°ëŒ€í•´ë³¸ë‹¤!

